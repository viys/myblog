---
title: 电源开发日志
date: 2022-10-28
cover: /images/4.jpg
tags:
  - 电源
  - PID
  - BUCK
categories:
 - 项目日志
 - 学习笔记
sticky: false
---
::: tip 介绍
学习电源知识，制作STM32数控电源
:::
<!-- more -->
# 电源开发日志

## 理论学习部分

### 电源分类

1电压源:家用

2电流源:充电器

\

3直流电源:DC

4交流电源:AC

\

5线性电源:LDO

6开关电源:BUCK

\

7降压电源

8升压电源

9升压降压电源



### LDO:

特点:负载功率越大,效率越低;

自身承担多余的电压,来实现降压;

控制简单,器件少,成本低,适用于负载小的场合(小电流,三极管CE端压降小的时候);

 

### BUCK:

优点:效率高,体积小,可以实现大功率(损耗小);



##### 实现要点:

1. 对输出电压进行检测;
2. 反馈到输入端;
3. 开关调节;
4. 对输出电压进行检测...

##### 问题:

1. 输出的电压有波动(纹波)
2. 输入波动对输出电压的影响
3. 负载也是波动的
4. 调节时间的长短对输出电压的影响(调节时间产生的结果称为:响应)



#### 开关:

##### MOSFET电子开关

MOSFET的损耗问题:

1. 导通损耗:漏极和源极的等效电阻Rdson;
2. 开关损耗:工艺原因MOSFET无法完全导通和完全断开;

 

##### IGBT开关器件

##### 特点:

1. 导通时可以通过更大的流;
2. 导通速度较MOSFET慢(开关频率低,体积大);
3. 导通压降为一定值(导通损耗比较低);

##### 两种开关器件体积与开关频率的关系特点

1. 成本不一样;
2. 频率不一样;
3. 体积(运送包的体积)不一样(体积越小频率越高,成本越低) -> 电感;
4. 需要把能量拆分成若干个包,分批次运输(为了降低体积进而降低成本);

*频率越高,分的批次越多,开关损耗增大,温升增高,进而影响器件寿命;

*温升每升高10度,系统的可靠性就会下降10倍;

### 开关电路元器件的作用

#### 电容:

特点:电容上的电压不会发生激变,电流会发生激变;

1. 使负载电压相对稳定;
2. 通过开关频率控制输出电压为所需电压;
3. 维持负载的正常工作;
4. 以电压的形式储存能量;

#### 电感(核心器件):

特点:电感上的电流不会发生激变,电压会发生激变;

1. 不会出现浪涌电流损坏电容;
2. 不耗能;
3. 和电容共同作用使输出电压稳定;
4. 以电流的方式储存能量;

*电感电压的电弧作用;

*电容的电压可以等效为电感的电流;

*电源涉及到能量的储存和转移; 

*电感饱和时对电流的抑制能力为0;

#### 续流二极管:

1. 续流,不会出现电弧损坏开关器件;
2. 替代电阻减小损耗;

*开关管的耐压 > Vin+二极管正向压降;

*二极管的反向耐压 > Vin;

### BUCK电源的核心器件

#### 电感: 

1. 工作模式:电流的下峰值不为0(连续工作模式CCM),某时刻为0(临界连续模式BCM),某段时间为0(断续模式DCM);
2. 电感的感应电压与电感电流的斜率有关;
3. 电感电压与开关的动作总是相反;
4. 电感的电压由Vin和Vout决定;
5. 电感上面的平均电流等于负载电流;
6. 在CCM,BCM工作状态下,电感的平均电流位于电感电流的几何中心;
7. 电感的额定电流要为基准电流的1.2倍;



##### 计算公式

电感选择:

1. ##### 输出电压大小:

   ![img](https://778b-1317013106.cos.ap-nanjing.myqcloud.com/img/202302261337097.png)

2. ##### 电感大小:

   ![img](https://778b-1317013106.cos.ap-nanjing.myqcloud.com/img/202302261328300.png)

3. ##### 电感额定电流:

![img](https://778b-1317013106.cos.ap-nanjing.myqcloud.com/img/202302261328652.png)



### TPS5430

经典DC-DC降压芯片

1. 电压反馈功能
2. 电流的反馈功能
3. PWM调节
4. 供电电源
5. 电压保护

*使用电源芯片时,高频回路和采样回路一定要短;

![img](https://778b-1317013106.cos.ap-nanjing.myqcloud.com/img/202302261338019.jpg) 

#### 电源芯片具备的功能

1. 欠压保护
2. 使能开关
3. 过温度保护
4. 高精度的基准电压
5. 软起电路
6. 自举充电电路
7. PWM波生成器
8. 电流保护
9. 内置mos管
10. 驱动电路



### 设计电源驱动要点

1. 实现开关作用;
2. PWM波形电路;
3. 软启定电路;
4. 悬浮的电路设计;
5. 自举电路;
6. 上电启动电路;
7. 电流保护电路;
8. 电压环控制电路;

*控制弱电而不是强电;

## 电路设计

### 原理图仿真

根据上面的`设计电源驱动要点`经过不断仿真设计出如下所示电路

![image-20230226154107984](https://778b-1317013106.cos.ap-nanjing.myqcloud.com/img/image-20230226154107984.png)

该电路未使用栅极驱动IC,方针成功.但考虑到若干三极管和LM358的成分并不低于一个功放IC的成本.故此电路仅作方针不做实物.

ps:由于存储问题,部分文件都已经打不开了,但是下面的电路都是经过仿真可行后绘制的原理图.

### 原理图设计

选用国产的栅极驱动EG2104设计的BUCK电路

![image-20230226160958803](https://778b-1317013106.cos.ap-nanjing.myqcloud.com/img/image-20230226160958803.png)

 [完整原理图下载](https://778b-1317013106.cos.ap-nanjing.myqcloud.com/pdf/32CNC.pdf) 

### PCB LAYOUT

![image-20230226161707254](https://778b-1317013106.cos.ap-nanjing.myqcloud.com/img/image-20230226161707254.png)

### 测试

#### 电源纹波

![image-20230226164713803](https://778b-1317013106.cos.ap-nanjing.myqcloud.com/img/image-20230226164713803.png)

这个波形是有问题的,原因是控制栅极驱动IC的PWM引脚(PA15)在单片机复位时该引脚被JTAG功能占用(高电平),随后才会被PWM功能占用,因此会出现很大的尖峰,发现问题后.将`GPIO_PinRemapConfig(GPIO_Remap_SWJ_JTAGDisable, ENABLE); `在main函数开头问题得以解决.由于存储问题解决后的上电波形图丢失(纹波形况可以参考下面负载测试的波形图),大致如上图去掉开始的大尖峰.

#### 负载测试

测试说明:将未工作的电机接在数控电源上,在波形图上观察电源抗压能力(PID)

![image-20230226163500380](https://778b-1317013106.cos.ap-nanjing.myqcloud.com/img/image-20230226163500380.png)

 [测试视频](https://778b-1317013106.cos.ap-nanjing.myqcloud.com/mp4/testCNC.mp4) 

![抗压测试波形](https://778b-1317013106.cos.ap-nanjing.myqcloud.com/img/image-20230226163415396.png)



## 总结

1. 设计电路时使用集成芯片并非糟糕的选择,反而芯片的性能和稳定性更强,因此手搓电路还是使用芯片需要斟酌斟酌.
2. 在MCU的原理图设计时尽量避免使用一些很特殊的引脚,来省去不必要的麻烦.
3. 电源的程序是在逻辑状态下编写,在很多函数之间的依赖以及先后问题上会变得复杂,因此要好好学习UCOS,降低开发难度的同时,使产品变得更加稳定.